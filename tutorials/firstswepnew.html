<!DOCTYPE html>
<html>
   <head>
      <link href="../styles/style.css" rel="stylesheet" type="text/css" />
      <title>First SWEP</title>
   </head>
   <script src="../base.js"></script>
   <body> 
      <div id="mw-page-base" class="noprint"></div>
      <div id="mw-head-base" class="noprint">
      <div class="property-list">
         <div class="hl2gmed-logo"><img alt="logo.png" src="../img/logo.svg" width="128" height="108"></div>
         <div id="propertyTextMain"><a href="../index.html">Main Page</a></div>

         <div id="mw-panel" class="noprint"> <!-- Collapsible Elements -->
            <div class="collapsible-nav"> 

               <!-- Lua Scripting -->
               <div class="portal" id='p-Lua_Scripting'>
                  <h5><a>Manuals</a></h5>
                  <div class="body">
                     <ul>
                        <li id="n-Overview"><a href="../documentation/base_page.html">Lua Docs</a></li>
                        <li id="n-Getting-Started"><a href="../tutorials/gettingstarted.html">Getting Started</a></li>
                        <li id="n-Tutorials"><a href="../tutorials/luadocs.html">Tutorials</a></li>
                     </ul>
                  </div>
               </div>
               <!-- About -->
               <div class="portal" id='p-About'>
                  <h5><a>About</a></h5>
                  <div class="body">
                     <ul>
                        <li id="n-FAQ"><a href="../other/faq.html">FAQ</a></li>
                        <li id="n-Info"><a href="../other/info.html">Info</a></li>
                        <li id="n-Screenshots"><a href="../other/screenshots.html">Screenshots</a></li>
                        <li id="n-Videos"><a href="../other/videos.html">Videos</a></li>
                     </ul>
                  </div>
               </div>
            </div>

         </div>  <!-- Collapsible Elements End -->
      </div>
   </div>
      <div id="content">
         <a id="top"></a>

         <a href="../index.html" title="GetBack">Return to Main Page</a>

         <h1>First Scripted Weapon</h1>
         <table style="padding: 2px; width: 100%; margin: -1px 0% 0px; border: 1px solid #aaa; border-left: 15px solid #333333; border-top: 0; background: #fbfbfb;"><tbody><tr><td style="width: 130px;"><a href="index43df.html" title="ConCommands"><img alt="Page white text.png" src="../img/Page_white_text.png" width="16" height="16"></a> <b>Description:</b></td><td>Article about SWEP.</td></tr>
         <tr><td><a href="indexfdbf.html" class="image" title="link=User:Dim1xs"><img alt="link=User:Dim1xs" src="../img/User.png" width="16" height="16"></a> <b>Author:</b></td><td><a href="../other/users/dim1xs.html" title="User:Dim1xs">Dim1xs</a></td></tr>
         <tr><td> <a href="index43df.html" title="ConCommands"><img alt="Calendar.png" src="../img/Calendar.png" width="16" height="16"></a> <b>Created:</b></td><td>September 28th 2023</td></tr>
         </tbody></table>
         <br>

         This article will learn you, how to create code your first Scripted Weapon - <span style="color: #FF0000;">SWEP</span>
         <h1 id="firstHeading" class="firstHeading">Scripted Weapons</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Better known as a SWep (or SWEP in some cases) a scripted weapon is a weapon that has an underlying script controlling its operation. In this tutorial, we will be making a SWep with fire bullets <span style="color: #0000ff;">function</span>.
               <br />
            </div>
         </div>

         <h1 id="secondHeading" class="secondHeading">The Basic Layout</h1>
         <div id="bodyContent">
            <div id="contentSub">
               First of all, you need a program, that can open and edit Lua format files.<br />
                  <br />
               Go to the directory (folder): <i>'..   /lua/weapons/'</i><br />
                  <br />
               Now create a new folder, with a simple name (without spaces) for your weapon. (for example: weapon_gun)<br />
               I recommend naming the folder so that there is a prefix at the beginning: <i>'weapon_'</i><br />

               I advise you to do this, because the game may have the same prefixes, and the game may break because of this.<br />
               <br />
            </div>
         </div>

         <h1 id="thirdHeading" class="thirdHeading">Files</h1>
         <div id="bodyContent">
            <div id="contentSub">
               In folder that you created, you need to create 3 files:<br />
               <br />
                  ðŸ”µinit.lua<br />
                  <br />
                  ðŸ”µcl_init.lua<br />
                  <br />
                  ðŸ”µshared.lua<br />
                  <br />
               init.lua is run Serverside <span style="color: #0000ff;">functions</span>.<br />
               <br />
               cl_init.lua is run Clientside <span style="color: #0000ff;">functions</span>.<br />
               <br />
               shared.lua is run in both environments (server/clientside).<br />
               <br />
               Now, for perfect work you have to open cl_init.lua and put here basic code:<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">include</span>( "shared.lua" ) --Must be here, for normal client initialize without errors.

<span style="color: #0000ff;">function </span> SWEP:DrawLargeWeaponBox( bSelected, xpos, ypos, boxWide, boxTall, selectedColor, alpha, number ) --Must be here so that it does not give an error.
<span style="color: #0000ff;">end</span>

<span style="color: #0000ff;">function </span> SWEP:DrawModel( flags )
<span style="color: #0000ff;">end</span>

<span style="color: #0000ff;">function </span> SWEP:MuzzleFlash( pos1, angles, type, firstPerson )
<span style="color: #0000ff;">end</span>
               </pre>
                <br />
               Now same for init.lua: <br />

                <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">include</span>( "shared.lua" ) --Must be here, for normal server initialize without errors.

<span style="color: #0000ff;">function </span> SWEP:CapabilitiesGet()
<span style="color: #0000ff;">end</span>
               </pre>
            </div>
         </div>

         <h1 id="fourthHeading" class="fourthHeading">SWEP Functions</h1>
         <div id="bodyContent">
            <div id="contentSub">
               You have to know, how classes in lua are working, for simple: <span style="color: #0000ff;">if</span> <span style="color: #0000ff;">function </span> has <span style="color: #FF0000;">self</span>: in the string it means <span style="color: #FF0000;">self</span> is the base class of the script. <br />
               <span style="color: #0000ff;">if</span> you will dont have SWEP: or ENT: etc in your <span style="color: #0000ff;">function </span> name, <span style="color: #FF0000;">self</span>: will not work! Because SWEP: is like a structure.<br />
               <br />
               Okay so, you must put a basic <span style="color: #0000ff;">functions</span> like Name, Viewmodel, Worldmodel of weapon, so for that you can use same <span style="color: #0000ff;">functions</span> like in GMOD:<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #FF0000;">SWEP</span>.Name                  = "Base Weapon" --in SpawnMenu Name
<span style="color: #FF0000;">SWEP</span>.PrintName             = "#HL2_357Handgun"
<span style="color: #FF0000;">SWEP</span>.ViewModel             = "models/weapons/v_357.mdl"
<span style="color: #FF0000;">SWEP</span>.WorldModel            = "models/weapons/w_357.mdl"
<span style="color: #FF0000;">SWEP</span>.HoldType              = "python" --dont working
<span style="color: #FF0000;">SWEP</span>.Slot                  = 1
<span style="color: #FF0000;">SWEP</span>.SlotPos               = 1
<span style="color: #FF0000;">SWEP</span>.Weight                = 7
<span style="color: #FF0000;">SWEP</span>.item_flags            = 0
<span style="color: #FF0000;">SWEP</span>.AutoSwitchTo          = 1
<span style="color: #FF0000;">SWEP</span>.AutoSwitchFrom        = 1
<span style="color: #FF0000;">SWEP</span>.BuiltRightHanded      = 0
<span style="color: #FF0000;">SWEP</span>.AllowFlipping         = 0 --actually does the same like ViewModelFlip in gmod.
<span style="color: #FF0000;">SWEP</span>.MeleeWeapon           = 0 --idk what it does.
<span style="color: #FF0000;">SWEP</span>.Spawnable             = true
<span style="color: #FF0000;">SWEP</span>.AdminOnly             = false
               </pre>
            </div>
         </div>

         <h1>Firearm Settings</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Each weapon must have its parameters configured (cartridges, magazine stock, initial ammunition, type of cartridges)<br />
               <br />
               Fortunately, in this lua, the ammo def <span style="color: #0000ff;">functions</span> work the same way as in gmod, which means that they are tables, and I can show you 2 ways for setting up ammo. <br />
               <br />   
               First way, is making in like in default gmod swep:<br /> 

               <pre class="lua" style="font-family: monospace;">
--This determins how big each clip/magazine for the gun is. You can 
--set it to -1 to disable the ammo system, meaning primary ammo will 
--not be displayed and will not be affected.
<span style="color: #FF0000;">SWEP</span>.Primary.ClipSize = 126

--This sets the number of rounds in the clip when you first get the gun. Again it can be set to -1.
<span style="color: #FF0000;">SWEP</span>.Primary.DefaultClip = 126

--Obvious. Determines whether the primary fire is automatic. This should be true/false
<span style="color: #FF0000;">SWEP</span>.Primary.Automatic = false

--Sets the ammunition type the gun uses, see below for a list of types.
<span style="color: #FF0000;">SWEP</span>.Primary.Ammo = "357

<span style="color: #FF0000;">SWEP</span>.Secondary.ClipSize = -1
<span style="color: #FF0000;">SWEP</span>.Secondary.DefaultClip = -1
<span style="color: #FF0000;">SWEP</span>.Secondary.Automatic = false
<span style="color: #FF0000;">SWEP</span>.Secondary.Ammo = "None"
               </pre>

               And here is the second way:<br /> 

               <pre class="lua" style="font-family: monospace;">
<span style="color: #FF0000;">SWEP</span>.Primary = 
{
   ClipSize=126,
   DefaultClip=126,
   Automatic = false,
   Ammo = "357",
}
<span style="color: #FF0000;">SWEP</span>.Secondary = 
{
   ClipSize=-1,
   DefaultClip=-1,
   Automatic = false,
   Ammo = "none",
}
               </pre>
            I like the second way better, it looks clearer to me.<br />
            <br />

            <h3 id="AmmoList" class="AmmoList">Ammo list:</h3>

            <pre class="lua" style="font-family: monospace;">
AR2 - Ammunition of the AR2/Pulse Rifle
AlyxGun - (name in-game "5.7mm Ammo")
Pistol - Ammunition of the 9MM Pistol
SMG1 - Ammunition of the SMG/MP7
357 - Ammunition of the .357 Magnum
XBowBolt - Ammunition of the Crossbow
Buckshot - Ammunition of the Shotgun
RPG_Round - Ammunition of the RPG/Rocket Launcher
SMG1_Grenade - Ammunition for the SMG/MP7 grenade launcher (secondary fire)
            </pre>

            And the last one is Damage of SWEP:<br /> 


            <pre class="lua" style="font-family: monospace;">
<span style="color: #FF0000;">SWEP</span>.damage             = 15
            </pre>

            </div>
         </div>

         <h1 id="sixthHeading" class="sixthHeading">Player Animations</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Now, i will show how to add a animations for the player:<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #FF0000;">SWEP</span>.m_acttable            =
{
   { ACT_RANGE_ATTACK1,       ACT_RANGE_ATTACK_AR2,         true },
   { ACT_RELOAD,             ACT_RELOAD_SMG1,           true },
   { ACT_IDLE,                  ACT_IDLE_SMG1,             true },
   { ACT_IDLE_ANGRY,            ACT_IDLE_ANGRY_SMG1,       true },
   { ACT_WALK,                  ACT_WALK_R<span style="color: #0000ff;">if</span>LE,               true },

   { ACT_HL2MP_IDLE,             ACT_HL2MP_IDLE_AR2,              false },
   { ACT_HL2MP_RUN,              ACT_HL2MP_RUN_AR2,               false },
   { ACT_HL2MP_IDLE_CROUCH,         ACT_HL2MP_IDLE_CROUCH_AR2,       false },
   { ACT_HL2MP_WALK_CROUCH,         ACT_HL2MP_WALK_CROUCH_AR2,       false },
   { ACT_HL2MP_GESTURE_RANGE_ATTACK,   ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },
   { ACT_HL2MP_GESTURE_RELOAD,         ACT_HL2MP_GESTURE_RELOAD_AR2,    false },
   { ACT_HL2MP_JUMP,             ACT_HL2MP_JUMP_AR2,              false },
   { ACT_RANGE_ATTACK1,          ACT_RANGE_ATTACK_AR2,            false },
    { ACT_MP_STAND_IDLE,            ACT_HL2MP_IDLE_AR2,              false },
   { ACT_MP_CROUCH_IDLE,            ACT_HL2MP_IDLE_CROUCH_AR2,       false },

   { ACT_MP_RUN,                 ACT_HL2MP_RUN_AR2,               false },
   { ACT_MP_CROUCHWALK,          ACT_HL2MP_WALK_CROUCH_AR2,       false },

   { ACT_MP_ATTACK_STAND_PRIMARYFIRE,  ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },
   { ACT_MP_ATTACK_CROUCH_PRIMARYFIRE, ACT_HL2MP_GESTURE_RANGE_ATTACK_AR2, false },

   { ACT_MP_RELOAD_STAND,           ACT_HL2MP_GESTURE_RELOAD_AR2,    false },
   { ACT_MP_RELOAD_CROUCH,          ACT_HL2MP_GESTURE_RELOAD_AR2,    false },

   { ACT_MP_JUMP,                ACT_HL2MP_JUMP_AR2,              false },
};
               </pre>

               Sadly HoldType from gmod is still not realised, so we have to use a act table like in C++, <br />
               below this is a example with AR2 animations (aka rifle), if you want to change them,<br /> 
               look for ACT Enums on gmod wiki, or wait untill they will be done in this wiki. <br />
               <br />
            </div>
         </div>

         <h1 id="seventhHeading" class="seventhHeading">Sounds</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Sadly, you can't do the shoot sound with the same way like in gmod, and you have to use SWEP.SoundData table:<br />
               <br />
               That's probably same thing like in game weapon scripts (.txt)<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #FF0000;">SWEP</span>.SoundData          =
{
   empty                = "Weapon_Pistol.Empty",
   single_shot          = "weapons/sound.wav" --any sound here
}
               </pre>
               Remember! You don't need to write 'sound/' in path! It puts it automatically!<br />
               <br />
            </div>
         </div>

         <h1 id="eighthHeading" class="eighthHeading"><span style="color: #0000ff;">Functions</span></h1>
         <div id="bodyContent">
            <div id="contentSub">
               Now you gonna code!<br />
               <br />
               Starting from basics, SWEP:Initialize is used for defining values/bools and also is used for default weapon <span style="color: #0000ff;">functions</span>:<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> </span><span style="color:#008000;">SWEP:Initialize()</span>
   <span style="color: #FF0000;"><span style="color: #FF0000;">self</span></span>.m_bReloadsSingly   = false;
   <span style="color: #FF0000;"><span style="color: #FF0000;">self</span></span>.m_bFiresUnderwater = false;
<span style="color: #0000ff;">end</span>
               </pre>
               Below you can see 2 basic <span style="color: #0000ff;">functions</span>, they do the same thing that is written on them.<br />
               <br />
               But of course i will give you a example, i'm not sure you could understand anything:<br />
               

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:Initialize()</span>
    <span style="color: #FF0000;">self</span>.IsBool = true -- it's gonna be true by default
    IsBool = true --the same but not in swep global.
    
    <span style="color: #FF0000;">self</span>.RandVal = 5 -- it's gonna equals to 5 by default
    RandVal = 5 -- the same but not in swep global.
<span style="color: #0000ff;">end</span>
               </pre>

               Next we will do the primary attack in our script!<br />
               

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:PrimaryAttack()</span>
   --code
<span style="color: #0000ff;">end</span>
               </pre>

               Every time you do the SWEP, don't forget to idenify the entity of the player who uses the weapon!<br />
               

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:PrimaryAttack()</span>
   <span style="color: #0000ff;">local</span> pPlayer = <span style="color: #FF0000;">self</span>:GetOwner() --getting player who uses a weapon.
    
    <span style="color: #0000ff;">if</span> ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      <span style="color: #0000ff;">return</span>;
   <span style="color: #0000ff;">end</span>

<span style="color: #0000ff;">end</span>
               </pre>

               Then there are primitive <span style="color: #0000ff;">functions</span>, animations, sound, subtraction of bullets from the clip:<br />
               

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:PrimaryAttack()</span>
   <span style="color: #0000ff;">local</span> pPlayer = <span style="color: #FF0000;">self</span>:GetOwner() --getting player who uses a weapon.
    
    <span style="color: #0000ff;">if</span> ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      <span style="color: #0000ff;">return</span>;
   <span style="color: #0000ff;"><span style="color: #0000ff;">end</span></span>
   
    <span style="color: #0000ff;">if</span> ( <span style="color: #FF0000;">self</span>.m_iClip1 <= 0 ) then --checking  for a empty clip
      <span style="color: #0000ff;">if</span> ( not <span style="color: #FF0000;">self</span>.m_bFireOnEmpty ) then
         <span style="color: #FF0000;">self</span>:Reload();
      else
         <span style="color: #FF0000;">self</span>:WeaponSound( 0 );
         <span style="color: #FF0000;">self</span>.m_flNextPrimaryAttack = 0.3;
      <span style="color: #0000ff;">end</span>

      <span style="color: #0000ff;">return</span>;
   <span style="color: #0000ff;">end</span>
    
    <span style="color: #FF0000;">self</span>:WeaponSound(1) --emit a shoot sound from SoundData
    <span style="color: #FF0000;">self</span>:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    <span style="color: #FF0000;">self</span>.m_iClip1 = <span style="color: #FF0000;">self</span>.m_iClip1 - 1; --remove one ammo from clip
    
    <span style="color: #FF0000;">self</span>.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

<span style="color: #0000ff;">end</span>
               </pre> 

               Okay, after that, i gonna show how to do the <span style="color: #0000ff;">function </span> for bullet, and recoil:<br />

               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:PrimaryAttack()</span>
   <span style="color: #0000ff;">local</span> pPlayer = <span style="color: #FF0000;">self</span>:GetOwner() --getting player who uses a weapon.
    
    <span style="color: #0000ff;">if</span> ( ToBaseEntity( pPlayer ) == NULL ) then -- returning if player is not valid ( basic check )
      <span style="color: #0000ff;">return</span>;
   <span style="color: #0000ff;">end</span>
   
    <span style="color: #0000ff;">if</span> ( <span style="color: #FF0000;">self</span>.m_iClip1 <= 0 ) then --checking  for a empty clip
      <span style="color: #0000ff;">if</span> ( not <span style="color: #FF0000;">self</span>.m_bFireOnEmpty ) then
         <span style="color: #FF0000;">self</span>:Reload();
      else
         <span style="color: #FF0000;">self</span>:WeaponSound( 0 );
         <span style="color: #FF0000;">self</span>.m_flNextPrimaryAttack = 0.3;
      <span style="color: #0000ff;">end</span>

      <span style="color: #0000ff;">return</span>;
   <span style="color: #0000ff;">end</span>
    
    <span style="color: #FF0000;">self</span>:WeaponSound(1) --emit a shoot sound from SoundData
    <span style="color: #FF0000;">self</span>:SendWeaponAnim(ACT_VM_PRIMARYATTACK) --do the animation of viewmodel
    pPlayer:SetAnimation( 5 ) --do the animation of player
    <span style="color: #FF0000;">self</span>.m_iClip1 = <span style="color: #FF0000;">self</span>.m_iClip1 - 1; --remove one ammo from clip
    
    <span style="color: #FF0000;">self</span>.m_flNextPrimaryAttack = gpGlobals.curtime() + 0.10; --next primary attack after shoot

   <span style="color: #0000ff;">local</span> vecSrc      = pPlayer:Weapon_ShootPosition(); --these two parametrs must be defined!
   <span style="color: #0000ff;">local</span> vecAiming      = pPlayer:GetAutoaimVector( 0.08715574274766 );

   -- vecSrc - position of fire, vecAiming - Directory where is shooting, bullet spread, distance, Ammo Type
   <span style="color: #0000ff;">local</span> info = FireBulletsInfo_t(1, vecSrc, vecAiming, vec3_origin,4096, <span style="color: #FF0000;">self</span>.m_iPrimaryAmmoType) -- actually BulletInfo table
    info.m_pAttacker = pPlayer --defining our attacker
    
    pPlayer:FireBullets( info ) --and shoot the bullet with info from table
    
    pPlayer:ViewPunch( QAngle( -0.5, random.RandomFloat( -1, 1 ), 0 ) ); -- recoil
<span style="color: #0000ff;">end</span>
               </pre>
                
            </div>
         </div>

         <h1 id="ninthHeading" class="ninthHeading">Reload</h1>
         <div id="bodyContent">
            <div id="contentSub">
               Reload is must be ALWAYS look like that:<br />
               
               <pre class="lua" style="font-family: monospace;">
<span style="color: #0000ff;">function</span> <span style="color:#008000;">SWEP:Reload()</span>
   ToHL2MPPlayer(<span style="color: #FF0000;">self</span>:GetOwner()):DoAnimationEvent( 3 ) -- do the reload animation
   <span style="color: #0000ff;">return</span> <span style="color: #FF0000;">self</span>:DefaultReload( <span style="color: #FF0000;">self</span>:GetMaxClip1(), <span style="color: #FF0000;">self</span>:GetMaxClip2(), 182 ); --actually reload our gun
<span style="color: #0000ff;">end</span>
               </pre>
               <br />
            </div>
         </div>

         Thank you for reading this tutorial, see ya later!<br />
               <br />

               <a href="https://discord.com/invite/5er8wTvQu7" title="HL2GMEDDiscord">JOIN HL2GMED DISCORD SERVER!</a>
      </div>
      <div id="mw-panel" class="noprint collapsible bav"> 
         <div id="p-logo">
            <a style="background-image: url(img/logo.svg);"> 
            </a>
         </div>
      </div>

      <div id="footer">
         <ul id="footer-info">
            <li id="footer-info-lastmod">
               This page was last mod<span style="color: #0000ff;">if</span>ied on 01.12.2023
            </li>
            <li id="footer-info-viewcount">
               Thank you, for opening this page
            </li>
         </ul>
      </div>
   </body>

</html>
